# 更新日志

所有版本的改动记录。最新版本在最前面。

---

## v1.8.0 (2025-02-10)

### 新增
- **模拟交易系统**：完整的虚拟交易功能，支持手动买卖、信号驱动一键跟单
  - 手动交易：输入股数和价格，实时预估费用（佣金+印花税+过户费），确认下单
  - 一键跟单：根据分析信号自动计算买卖方向和仓位比例
  - A 股仿真规则：佣金万 2.5（最低 5 元）+ 印花税 0.05%（仅卖出）+ 过户费 + T+1 + 涨跌停
  - 美股规则：零佣金 + T+0
- **持仓管理面板**：总资产、可用资金、浮动盈亏、已实现盈亏统计卡片 + 持仓列表表格
  - 支持重置账户（自定义初始资金）
  - 数据持久化至 `~/.stock-strategy/portfolio.json`
- **交易记录列表**：按时间倒序展示，支持按股票、方向、来源（手动/信号/回测）筛选
- **策略回测引擎**：输入股票代码、日期范围和初始资金，自动运行历史回测
  - 基于技术指标口诀规则逐日生成信号并模拟交易
  - 输出关键指标：总收益率、年化收益率、最大回撤、夏普比率、胜率、盈亏比
  - 净值曲线图（Plotly）+ K 线图叠加买卖点标注
  - 回测交易记录表
- **视图切换**：侧边栏新增顶部导航栏（分析 / 模拟交易 / 回测），主区域根据选中视图切换内容
- **交易按钮**：StockCard 标题栏新增「交易」和「回测」快捷按钮
- 后端新增 6 个 API 端点：
  - `GET /api/portfolio` — 获取持仓和汇总
  - `POST /api/portfolio/reset` — 重置账户
  - `POST /api/trade` — 手动买卖
  - `POST /api/trade/signal` — 信号驱动交易
  - `GET /api/trades` — 交易历史
  - `POST /api/backtest` — 运行回测

### 新增文件
- `src/trading/__init__.py`、`fees.py`、`portfolio.py`、`trade_engine.py`、`backtest.py`
- `desktop/src/components/TradeModal.tsx`、`PortfolioDashboard.tsx`、`TradeHistory.tsx`、`BacktestPanel.tsx`、`PnLChart.tsx`

---

## v1.7.0 (2025-02-10)

### 新增
- **口诀规则引擎**：基于经典技术分析口诀自动生成买卖建议
  - RSI6 破 30 + MACD 金叉 → 短线买
  - RSI6 破 70 + MACD 死叉 → 短线卖
  - 0 轴上金叉大胆做，0 轴下金叉少碰
  - 震荡不上 70、不下 30 → 不操作
- 新增 RSI6（6周期）指标计算，与原有 RSI14 并存
- 新增 MACD 金叉/死叉检测（最近 3 根 bar 内）
- 新增 MACD 0 轴位置判断
- API 响应新增 `detail.rsi6`、`detail.macd_cross`、`detail.macd_above_zero`、`detail.advice` 字段
- 前端 StockCard 在标题下方醒目展示口诀买卖建议卡片，包含：
  - 主建议（买入/卖出/观望）+ 口诀规则 + 详细说明
  - RSI6 / MACD交叉 / 0轴位置 状态指示条
  - 多条建议依次展示
- 评分明细 Tab 底部新增「口诀指标原始值」区域

---

## v1.6.0 (2025-02-10)

### 新增
- **红绿色调适配**：A股 K 线图遵循中国惯例（红涨绿跌），美股遵循国际惯例（绿涨红跌），成交量柱状图同步适配
- **K 线图中文化**：日期轴格式、悬浮提示、工具栏按钮文字全部使用中文；Plotly 配置了 `zh-CN` locale
- **鼠标滚轮缩放**：K 线图启用 `scrollZoom`，支持鼠标滚轮放大/缩小和拖拽平移
- **多周期 K 线**：K 线图上方新增周期切换栏，支持 分时、五日、日K、周K、月K、分钟 六种周期
  - 分时使用折线图展示（1 分钟级别）
  - 其他周期使用标准蜡烛图
  - 切换周期时异步从后端获取对应粒度行情数据
- **后端新增 `/api/price` 接口**：支持按 ticker/market/interval/period_days 灵活获取不同周期行情数据
- 美股行情数据支持 yfinance 的 1m/5m/15m/1d/1wk/1mo 粒度
- A股行情数据支持 akshare 的分钟级（1/5/15 分钟）和日/周/月级别

---

## v1.5.2 (2025-02-10)

### 修复
- 修复新闻"查看原文"链接无法跳转的问题：Electron 默认阻止 `target="_blank"` 打开新窗口，现通过 `shell.openExternal` 将外部链接在系统默认浏览器中打开
- 同时拦截页面内导航到外部 URL 的情况，防止 Electron 窗口被意外导航到外部网站

---

## v1.5.1 (2025-02-10)

### 修复
- 修复新闻摘要为空的问题：
  - Finnhub 新闻：当 `summary` 为空时降级使用 `headline`
  - Yahoo Finance 新闻：尝试 `summary` / `description` / `content` 多个字段，均为空则降级使用标题
  - A股东方财富新闻：修复 `新闻内容` 为空或 `nan` 时的降级逻辑
  - 后端 server.py 增加最终安全网：确保返回给前端的 summary 永远不为空
  - 前端 NewsFeed 详情面板：摘要与标题相同时显示「该新闻来源未提供详细摘要」，不再显示「暂无新闻摘要」

---

## v1.5.0 (2025-02-10)

### 新增
- 自选股功能：在分析结果表中点击星标可将股票添加/移除自选
- 侧边栏新增「自选股」Tab 页，显示已收藏的美股和A股列表
- 自选股列表支持一键删除单只股票
- 「分析自选股」按钮：一键分析所有自选股票
- 「导入到分析配置」按钮：将自选股填入配置区的代码输入框
- 自选数据通过 localStorage 持久化，关闭后再打开不丢失

---

## v1.4.0 (2025-02-10)

### 新增
- 新闻详情展开功能：点击新闻条目可展开查看摘要内容、情感标签、详细得分和原文链接
- 顶部应用菜单：编辑、视图、开发、窗口四个菜单
- 开发菜单中的「控制台」开关（快捷键 Cmd+Option+I / Ctrl+Shift+I）

### 优化
- 后端 SentimentResultResponse 新增 summary 和 url 字段，传递新闻摘要和原文链接
- 新闻列表高度从 320px 增加到 500px，展开详情时有更好的浏览体验
- 移除启动时自动打开 DevTools，改为通过菜单手动控制

---

## v1.3.0 (2025-02-10)

### 优化
- 前端 API 请求添加超时机制（普通请求 10 秒，分析请求 10 分钟）
- 分析过程中主区域显示大号加载动画、实时计时器和阶段提示
- 空股票代码提交时前端直接拦截提示
- 分析无结果时提示"请检查股票代码是否正确"
- 后端启动时后台线程预加载 NLP 模型，不阻塞服务响应
- 健康检查接口增加模型加载状态字段
- 分析接口添加详细日志（开始/完成/耗时）

### 修复
- 修复点击分析按钮后无响应的问题（缺少前端超时和加载反馈）

---

## v1.2.0 (2025-02-10)

### 新增
- 软件界面全面中文化

### 优化
- index.html 标题改为"股票舆情策略分析"
- Electron 窗口标题、错误弹窗改为中文
- 侧边栏标签（美股代码、A股代码、策略权重等）改为中文
- 分析概览表头（代码、市场、舆情、技术面等）改为中文
- 股票详情卡片 Tab（K线图、舆情走势、新闻、评分明细）改为中文
- 图表标题、坐标轴、悬浮提示改为中文
- 信号徽章移除英文冗余显示，仅保留中文信号名
- 市场标签由 US/CN 改为 美股/A股

---

## v1.1.1 (2025-02-10)

### 优化
- Electron 启动时自动检测并清理占用 8321 端口的僵尸进程
- 支持复用已运行的 Python 后端实例
- Python 查找逻辑增强：依次尝试 python3、python、python3.12 等多种路径
- 启动失败时错误弹窗显示具体的 Python 报错内容
- 健康检查超时从 30 秒延长至 60 秒
- 添加 SIGINT/SIGTERM 信号处理，确保退出时清理 Python 进程

### 修复
- 修复项目迁移后 venv 路径失效导致 Python 后端无法启动的问题

---

## v1.1.0 (2025-02-10)

### 新增
- Electron 桌面客户端（React + Vite + TailwindCSS）
- FastAPI 后端服务（server.py），提供 REST API 接口
- 侧边栏：自选股配置、新闻回溯天数、策略权重调节
- 分析概览表：多股票对比，点击切换详情
- 股票详情卡片：K线图、舆情走势图、新闻列表、评分明细
- 信号徽章组件：中英文信号名称 + 评分
- 交互式图表：Plotly.js K线图（含成交量）和舆情时间线

---

## v1.0.0 (2025-02-10)

### 新增
- 项目初始化，Python 策略引擎核心
- 美股新闻采集（Finnhub API + Yahoo Finance）
- A股新闻采集（akshare 东方财富）
- 英文情感分析（ProsusAI/finbert）
- 中文情感分析（uer/roberta-base-finetuned-chinanews-chinese）
- 技术指标计算（RSI、MACD、均线、布林带）
- 综合信号生成（加权评分 + 仓位建议）
- 美股行情数据（yfinance）
- A股行情数据（akshare）
- CLI 报告输出
- 配置文件支持（config.yaml）
